<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..\js\assets\modules\service\analytic\D3PlotService.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/capdfHydrogeochemCtrl.html">capdfHydrogeochemCtrl</a></li>
                                <li><a href="../classes/CapdfWMSService.html">CapdfWMSService</a></li>
                                <li><a href="../classes/collapseInfoPanelCtrl.html">collapseInfoPanelCtrl</a></li>
                                <li><a href="../classes/D3PlotService.html">D3PlotService</a></li>
                                <li><a href="../classes/defaultAnalyticCtrl.html">defaultAnalyticCtrl</a></li>
                                <li><a href="../classes/FilterStateService.html">FilterStateService</a></li>
                                <li><a href="../classes/GetCSWRecordService.html">GetCSWRecordService</a></li>
                                <li><a href="../classes/GetFilterParamService.html">GetFilterParamService</a></li>
                                <li><a href="../classes/GetWFSRelatedService.html">GetWFSRelatedService</a></li>
                                <li><a href="../classes/GetWMSRelatedService.html">GetWMSRelatedService</a></li>
                                <li><a href="../classes/GMLParserService.html">GMLParserService</a></li>
                                <li><a href="../classes/googleMapCtrl.html">googleMapCtrl</a></li>
                                <li><a href="../classes/GoogleMapService.html">GoogleMapService</a></li>
                                <li><a href="../classes/infoPanelCtrl.html">infoPanelCtrl</a></li>
                                <li><a href="../classes/LayerManagerService.html">LayerManagerService</a></li>
                                <li><a href="../classes/layerPanelCtrl.html">layerPanelCtrl</a></li>
                                <li><a href="../classes/layerSearchCtrl.html">layerSearchCtrl</a></li>
                                <li><a href="../classes/loadAnalyticCtrl.html">loadAnalyticCtrl</a></li>
                                <li><a href="../classes/loadFilterCtrl.html">loadFilterCtrl</a></li>
                                <li><a href="../classes/NVCLService.html">NVCLService</a></li>
                                <li><a href="../classes/pressureDbCtrl.html">pressureDbCtrl</a></li>
                                <li><a href="../classes/PreviewMapService.html">PreviewMapService</a></li>
                                <li><a href="../classes/QuerierPanelService.html">QuerierPanelService</a></li>
                                <li><a href="../classes/RenderHandlerService.html">RenderHandlerService</a></li>
                                <li><a href="../classes/RenderStatusService.html">RenderStatusService</a></li>
                                <li><a href="../classes/SimpleXPathService.html">SimpleXPathService</a></li>
                                <li><a href="../classes/StyleService.html">StyleService</a></li>
                                <li><a href="../classes/WFSService.html">WFSService</a></li>
                                <li><a href="../classes/WMS_1_1_0_Service.html">WMS_1_1_0_Service</a></li>
                                <li><a href="../classes/WMS_1_3_0_Service.html">WMS_1_3_0_Service</a></li>
                                <li><a href="../classes/WMSService.html">WMSService</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/analytic.html">analytic</a></li>
                                <li><a href="../modules/controllers.html">controllers</a></li>
                                <li><a href="../modules/http.html">http</a></li>
                                <li><a href="../modules/layer.html">layer</a></li>
                                <li><a href="../modules/map.html">map</a></li>
                                <li><a href="../modules/utility.html">utility</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ..\js\assets\modules\service\analytic\D3PlotService.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Service class related to handling all things related to making http cswrecords
 * @module analytic
 * @class D3PlotService
 * 
 */
allModules.service(&#x27;D3PlotService&#x27;,[&#x27;$http&#x27;,&#x27;$q&#x27;,function ($http,$q) {
    
    /**
     * Plot a scatter plot graph into the divId selected
     * @method plotScatter
     * @param data - the data for plotting in an array
     * @param divId - the id of the div for rendering the graph
     * @param height - the height of the graph 
     * @param xaxis - x-axis
     * @param yaxis - y-axis
     * 
     */
    this.plotScatter = function(data,divId,height,xaxis,yaxis){
        this.clearPlot(divId);
        this.d3=d3;
        var margin = {top: 15, right: 0, bottom: 20, left: 30};
        
        var targetWidth = $(&quot;#&quot; + divId).width();
        var targetHeight = height;
        
        
        width = targetWidth - margin.left - margin.right,
        height = targetHeight - margin.top - margin.bottom;

        var container = d3.select(&quot;#&quot; + divId);      
        var svg = container.append(&quot;svg&quot;);

        /* 
         * value accessor - returns the value to encode for a given data object.
         * scale - maps value to a visual display encoding, such as a pixel position.
         * map function - maps from data value to display value
         * axis - sets up axis
         */ 
    
        // setup x 
        var xValue = function(d) { return d.xaxis;}, // data -&gt; value
            xScale = d3.scale.linear().range([0, width]), // value -&gt; display
            xMap = function(d) { return xScale(xValue(d));}, // data -&gt; display
            xAxis = d3.svg.axis().scale(xScale).orient(&quot;bottom&quot;);
    
            var yValue = function(d) { return d[&quot;yaxis&quot;];}, // data -&gt; value
            yScale = d3.scale.linear().range([height, 0]), // value -&gt; display
            yMap = function(d) { return yScale(yValue(d));}, // data -&gt; display
            yAxis = d3.svg.axis().scale(yScale).orient(&quot;left&quot;);
    
        // setup fill color
        var cValue = function(d) { return d.highlight;},
            color = d3.scale.category10();
    
        svg = svg
            .attr(&quot;width&quot;, targetWidth)
            .attr(&quot;height&quot;, targetHeight)
          .append(&quot;g&quot;)
            .attr(&quot;transform&quot;, &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;);
    
        // add the tooltip area to the webpage
        var tooltip = d3.select(&quot;body&quot;).append(&quot;div&quot;)
            .attr(&quot;class&quot;, &quot;graphTooltip&quot;)
            .style(&quot;opacity&quot;, 0);
    
       
          // change string (from CSV) into number format
          data.forEach(function(d) {
            d.xaxis = +d.xaxis
            d[&quot;yaxis&quot;] = +d[&quot;yaxis&quot;];
    //        console.log(d);
          });
    
          // don&#x27;t want dots overlapping axis, so add in buffer to data domain
          xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
          yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);
    
          // x-axis
          svg.append(&quot;g&quot;)
              .attr(&quot;class&quot;, &quot;x axis&quot;)
              .attr(&quot;transform&quot;, &quot;translate(0,&quot; + height + &quot;)&quot;)
              .call(xAxis)
            .append(&quot;text&quot;)
              .attr(&quot;class&quot;, &quot;label&quot;)
              .attr(&quot;x&quot;, width)
              .attr(&quot;y&quot;, -6)
              .style(&quot;text-anchor&quot;, &quot;end&quot;)
              .text(xaxis);
    
          // y-axis
          svg.append(&quot;g&quot;)
              .attr(&quot;class&quot;, &quot;y axis&quot;)
              .call(yAxis)
            .append(&quot;text&quot;)
              .attr(&quot;class&quot;, &quot;label&quot;)
              .attr(&quot;transform&quot;, &quot;rotate(-90)&quot;)
              .attr(&quot;y&quot;, 6)
              .attr(&quot;dy&quot;, &quot;.71em&quot;)
              .style(&quot;text-anchor&quot;, &quot;end&quot;)
              .text(yaxis);
    
          // draw dots
          svg.selectAll(&quot;.dot&quot;)
              .data(data)
            .enter().append(&quot;circle&quot;)
              .attr(&quot;class&quot;, &quot;dot&quot;)
              .attr(&quot;r&quot;, 3.5)
              .attr(&quot;cx&quot;, xMap)
              .attr(&quot;cy&quot;, yMap)
              .style(&quot;fill&quot;, function(d) { return color(d.highlight); })
              .on(&quot;mouseover&quot;, function(d) {
                  tooltip.transition()
                       .duration(200)
                       .style(&quot;opacity&quot;, .9);
                  tooltip.html(d[&quot;tooltip&quot;] + &quot;&lt;br/&gt; (x:&quot; + xValue(d) 
                    + &quot;, y:&quot; + yValue(d) + &quot;)&quot;)
                       .style(&quot;left&quot;, (d3.event.pageX + 5) + &quot;px&quot;)
                       .style(&quot;top&quot;, (d3.event.pageY - 28) + &quot;px&quot;);
              })
              .on(&quot;mouseout&quot;, function(d) {
                  tooltip.transition()
                       .duration(500)
                       .style(&quot;opacity&quot;, 0);
              });
    
          // draw legend
          var legend = svg.selectAll(&quot;.legend&quot;)
              .data(color.domain())
            .enter().append(&quot;g&quot;)
              .attr(&quot;class&quot;, &quot;legend&quot;)
              .attr(&quot;transform&quot;, function(d, i) { return &quot;translate(0,&quot; + i * 20 + &quot;)&quot;; });
    
          // draw legend colored rectangles
          legend.append(&quot;rect&quot;)
              .attr(&quot;x&quot;, width - 18)
              .attr(&quot;width&quot;, 18)
              .attr(&quot;height&quot;, 18)
              .style(&quot;fill&quot;, color);
    
          // draw legend text
          legend.append(&quot;text&quot;)
              .attr(&quot;x&quot;, width - 24)
              .attr(&quot;y&quot;, 9)
              .attr(&quot;dy&quot;, &quot;.35em&quot;)
              .style(&quot;text-anchor&quot;, &quot;end&quot;)
              .text(function(d) { return d;});
        };
     
     /**
      * Plot a boxPlot graph into the divId selected
      * @method plotBox
      * @param data - the data for plotting in an array
      * @param id - the id of the div for rendering the graph
      * @param height - the height of the graph 
      * @param x - x-axis
      * @param y - y-axis
      *
      */
     this.plotBox = function(data,id,height,x,y){
         this.clearPlot(id);
         var divId = &quot;#&quot; + id;
         var targetWidth = $(divId).width();
         var targetHeight = height;
         var container = d3.select(divId);
         this.preserveAspectRatio = true;
         this.d3svg = container.append(&quot;svg&quot;)
             .attr(&quot;preserveAspectRatio&quot;, this.preserveAspectRatio ? &quot;xMidYMid&quot; : &quot;none&quot;)
             .attr(&quot;viewBox&quot;,  &quot;0 0 &quot; + targetWidth + &quot; &quot; + targetHeight);                                     
         
         var csv = data; 

         
         this.d3=d3;
         var labels = true; // show the text labels beside individual boxplots?

         var margin = {top: 15, right: 0, bottom: 45, left: 30};
         var width = targetWidth - margin.left - margin.right;
         var height = targetHeight - margin.top - margin.bottom;
             
         var min = Infinity,
             max = -Infinity;
             
         
        
             // using an array of arrays with
             // data[n][2] 
             // where n = number of columns in the csv file 
             // data[i][0] = name of the ith column
             // data[i][1] = array of values of ith column

             var data = [];
             data[0] = [];
             data[1] = [];
             data[2] = [];
             data[3] = [];
             
             // add more rows if your csv file has more columns

             // add here the header of the csv file
             data[0][0] = x;
             data[1][0] = y;
             data[2][0] = x + &quot;-bounded&quot;;
             data[3][0] = y + &quot;-bounded&quot;;
            
             // add more rows if your csv file has more columns

             data[0][1] = [];
             data[1][1] = [];
             data[2][1] = [];
             data[3][1] = [];
          
           
             csv.forEach(function(x) {
                 var v1 = Math.floor(x.x1),
                     v2 = Math.floor(x.y1),
                     v3 = Math.floor(x.x2),
                     v4 = Math.floor(x.y2)
                   
                     // add more variables if your csv file has more columns
                     //2147483646
                     
                     
                 var rowMax = -2147483646
                 for(var i = 0; i &lt; 4; i++){
                     if(v1 &gt; rowMax &amp;&amp; v1 != 2147483646){
                         rowMax=v1;
                     }
                     if(v2 &gt; rowMax &amp;&amp; v2 != 2147483646){
                         rowMax=v2;
                     }
                     if(v3 &gt; rowMax &amp;&amp; v3 != 2147483646){
                         rowMax=v3;
                     }
                     if(v4 &gt; rowMax &amp;&amp; v4 != 2147483646){
                         rowMax=v4;
                     }
                 }
                 
                 
                 var rowMin = 2147483646
                 for(var i = 0; i &lt; 4; i++){
                     if(v1 &lt; rowMin &amp;&amp; v1 != 2147483646){
                         rowMin=v1;
                     }
                     if(v2 &lt; rowMin &amp;&amp; v2 != 2147483646){
                         rowMin=v2;
                     }
                     if(v3 &lt; rowMin &amp;&amp; v3 != 2147483646){
                         rowMin=v3;
                     }
                     if(v4 &lt; rowMin &amp;&amp; v4 != 2147483646){
                         rowMin=v4;
                     }
                 }
                
                 

                 data[0][1].push(v1);
                 data[1][1].push(v2);
                 data[2][1].push(v3);
                 data[3][1].push(v4);
               
                  // add more rows if your csv file has more columns
                  
                 if (rowMax &gt; max) max = rowMax;
                 if (rowMin &lt; min) min = rowMin; 
             });
           
             var chart = d3.box()
                 .whiskers(iqr(1.5))
                 .height(height) 
                 .domain([min, max])
                 .showLabels(labels);

             var svg = this.d3svg;
             
             svg = svg
                 .attr(&quot;width&quot;, width + margin.left + margin.right)
                 .attr(&quot;height&quot;, height + margin.top + margin.bottom)
                 .attr(&quot;class&quot;, &quot;box&quot;)    
                 .append(&quot;g&quot;)
                 .attr(&quot;transform&quot;, &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;);
             
             // the x-axis
             var x = d3.scale.ordinal()     
                 .domain( data.map(function(d) { return d[0] } ) )       
                 .rangeRoundBands([0 , width], 0.7, 0.3);        

             var xAxis = d3.svg.axis()
                 .scale(x)
                 .orient(&quot;bottom&quot;);

             // the y-axis
             var y = d3.scale.linear()
                 .domain([min, max])
                 .range([height + margin.top, 0 + margin.top]);
             
             var yAxis = d3.svg.axis()
             .scale(y)
             .orient(&quot;left&quot;);

             // draw the boxplots    
             svg.selectAll(&quot;.box&quot;)      
               .data(data)
               .enter().append(&quot;g&quot;)
                 .attr(&quot;transform&quot;, function(d) { return &quot;translate(&quot; +  x(d[0])  + &quot;,&quot; + margin.top + &quot;)&quot;; } )
               .call(chart.width(x.rangeBand())); 
             
                   
             // add a title
             svg.append(&quot;text&quot;)
                 .attr(&quot;x&quot;, (width / 2))             
                 .attr(&quot;y&quot;, 0 + (margin.top / 2))
                 .attr(&quot;text-anchor&quot;, &quot;middle&quot;)  
                 .style(&quot;font-size&quot;, &quot;8px&quot;) 
                 //.style(&quot;text-decoration&quot;, &quot;underline&quot;)  
                 .text(&quot;Box Plot&quot;);
          
              // draw y axis
             svg.append(&quot;g&quot;)
                 .attr(&quot;class&quot;, &quot;y axis&quot;)
                 .call(yAxis)
                 .append(&quot;text&quot;) // and text1
                   .attr(&quot;transform&quot;, &quot;rotate(-90)&quot;)
                   .attr(&quot;y&quot;, 6)
                   .attr(&quot;dy&quot;, &quot;.71em&quot;)
                   .style(&quot;text-anchor&quot;, &quot;end&quot;)
                   .style(&quot;font-size&quot;, &quot;8px&quot;) 
                   .text(&quot;Values&quot;);        
             
             // draw x axis  
             svg.append(&quot;g&quot;)
               .attr(&quot;class&quot;, &quot;x axis&quot;)
               .attr(&quot;transform&quot;, &quot;translate(0,&quot; + (height  + margin.top + 10) + &quot;)&quot;)
               .call(xAxis)
             
         // Returns a function to compute the interquartile range.
         function iqr(k) {
           return function(d, i) {
             var q1 = d.quartiles[0],
                 q3 = d.quartiles[2],
                 iqr = (q3 - q1) * k,
                 i = -1,
                 j = d.length;
             while (d[++i] &lt; q1 - iqr);
             while (d[--j] &gt; q3 + iqr);
             return [i, j];
           };
         }
                                
         var text = svg.selectAll(&quot;text&quot;)
         .attr(&quot;font-size&quot;, &quot;10px&quot;);

     };
                 
     
     /**
      * Clear the div of any graph plotting
      * @param - divId the id of the div to remove the graph.
      */
     this.clearPlot = function(id){
         var divId = &quot;#&quot; + id;        
         var container = d3.select(divId);
         container.select(&#x27;*&#x27;).remove();       
         container = null;
     };

   

} ]);
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
