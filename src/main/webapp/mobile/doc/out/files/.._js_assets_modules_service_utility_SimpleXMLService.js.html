<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..\js\assets\modules\service\utility\SimpleXMLService.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/capdfHydrogeochemCtrl.html">capdfHydrogeochemCtrl</a></li>
                                <li><a href="../classes/CapdfWMSService.html">CapdfWMSService</a></li>
                                <li><a href="../classes/collapseInfoPanelCtrl.html">collapseInfoPanelCtrl</a></li>
                                <li><a href="../classes/D3PlotService.html">D3PlotService</a></li>
                                <li><a href="../classes/defaultAnalyticCtrl.html">defaultAnalyticCtrl</a></li>
                                <li><a href="../classes/FilterStateService.html">FilterStateService</a></li>
                                <li><a href="../classes/GetCSWRecordService.html">GetCSWRecordService</a></li>
                                <li><a href="../classes/GetFilterParamService.html">GetFilterParamService</a></li>
                                <li><a href="../classes/GetWFSRelatedService.html">GetWFSRelatedService</a></li>
                                <li><a href="../classes/GetWMSRelatedService.html">GetWMSRelatedService</a></li>
                                <li><a href="../classes/GMLParserService.html">GMLParserService</a></li>
                                <li><a href="../classes/googleMapCtrl.html">googleMapCtrl</a></li>
                                <li><a href="../classes/GoogleMapService.html">GoogleMapService</a></li>
                                <li><a href="../classes/infoPanelCtrl.html">infoPanelCtrl</a></li>
                                <li><a href="../classes/LayerManagerService.html">LayerManagerService</a></li>
                                <li><a href="../classes/layerPanelCtrl.html">layerPanelCtrl</a></li>
                                <li><a href="../classes/layerSearchCtrl.html">layerSearchCtrl</a></li>
                                <li><a href="../classes/loadAnalyticCtrl.html">loadAnalyticCtrl</a></li>
                                <li><a href="../classes/loadFilterCtrl.html">loadFilterCtrl</a></li>
                                <li><a href="../classes/NVCLService.html">NVCLService</a></li>
                                <li><a href="../classes/pressureDbCtrl.html">pressureDbCtrl</a></li>
                                <li><a href="../classes/PreviewMapService.html">PreviewMapService</a></li>
                                <li><a href="../classes/QuerierPanelService.html">QuerierPanelService</a></li>
                                <li><a href="../classes/RenderHandlerService.html">RenderHandlerService</a></li>
                                <li><a href="../classes/RenderStatusService.html">RenderStatusService</a></li>
                                <li><a href="../classes/SimpleXPathService.html">SimpleXPathService</a></li>
                                <li><a href="../classes/StyleService.html">StyleService</a></li>
                                <li><a href="../classes/WFSService.html">WFSService</a></li>
                                <li><a href="../classes/WMS_1_1_0_Service.html">WMS_1_1_0_Service</a></li>
                                <li><a href="../classes/WMS_1_3_0_Service.html">WMS_1_3_0_Service</a></li>
                                <li><a href="../classes/WMSService.html">WMSService</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/analytic.html">analytic</a></li>
                                <li><a href="../modules/controllers.html">controllers</a></li>
                                <li><a href="../modules/http.html">http</a></li>
                                <li><a href="../modules/layer.html">layer</a></li>
                                <li><a href="../modules/map.html">map</a></li>
                                <li><a href="../modules/utility.html">utility</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ..\js\assets\modules\service\utility\SimpleXMLService.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * SimpleXPathService handles xml file manipulation.
 * @module utility
 * @class SimpleXPathService
 * 
 */
allModules.service(&#x27;SimpleXMLService&#x27;,[&#x27;$rootScope&#x27;,&#x27;Constants&#x27;,function ($rootScope,Constants) {
   
    /**
     * A wrapper around the DOM defined Document.evaluate function
     * Because not every browser supports document.evaluate we need to have a pure javascript
     * backup in place
     * 
     * @method evaluateXPath
     * @param document - document
     * @param domNode - domNode
     * @param xPath - xPath
     * @param resultType - https://developer.mozilla.org/en-US/docs/Web/API/Document/evaluate#Result_types
     * @return dom - the dom result
     */
    this.evaluateXPath = function(document, domNode, xPath, resultType) {
        if (document.evaluate) {
            var result;
            try {
                result = document.evaluate(xPath, domNode, document.createNSResolver(domNode), resultType, null);
                return result;
            } catch(e) {
                console.error(&quot;SimpleXMLService.evaluateXPath() Exception&quot;, e);
                // Return empty result
                switch(resultType) {
                    case Constants.XPATH_STRING_TYPE:
                        return {
                            stringValue : &quot;&quot;
                        };
                    case Constants.XPATH_UNORDERED_NODE_ITERATOR_TYPE:
                        return {
                            _arr : [],
                            _i : 0,
                            iterateNext : function() {
                                return null;
                            }
                        };
                    default:
                        throw &#x27;Unrecognised resultType&#x27;;
                }
            };
            
        } else {
            //This gets us a list of dom nodes
            var matchingNodeArray = XPath.selectNodes(xPath, domNode);
            if (!matchingNodeArray) {
                matchingNodeArray = [];
            }

            //we need to turn that into an XPathResult object (or an emulation of one)
            switch(resultType) {
            case Constants.XPATH_STRING_TYPE:
                var stringValue = null;
                if (matchingNodeArray.length &gt; 0) {
                    stringValue = this.getNodeTextContent(matchingNodeArray[0]);
                }
                return {
                    stringValue : stringValue
                };
            case Constants.XPATH_UNORDERED_NODE_ITERATOR_TYPE:
                return {
                    _arr : matchingNodeArray,
                    _i : 0,
                    iterateNext : function() {
                        if (this._i &gt;= this._arr.length) {
                            return null;
                        } else  {
                            return this._arr[this._i++];
                        }
                    }
                };

            }

            throw &#x27;Unrecognised resultType&#x27;;
        }
    };
    
    
    /**
     * Evaluates an XPath which will return an array of W3C DOM nodes
     * 
     * @method evaluateXPathNodeArray
     * @param domNode - domNode
     * @param xPath - xPath
     * @return dom - the dom result
     */
    this.evaluateXPathNodeArray = function(domNode, xPath) {
        var document = domNode.ownerDocument;
        var xpathResult = null;
        try {
            xpathResult = this.evaluateXPath(document, domNode, xPath,Constants.XPATH_UNORDERED_NODE_ITERATOR_TYPE);
        } catch(err) {
            return [];
        }
        var matchingNodes = [];

        var matchingNode = xpathResult.iterateNext();
        while (matchingNode) {
            matchingNodes.push(matchingNode);
            matchingNode = xpathResult.iterateNext();
        }

        return matchingNodes;
    };
    
    this.evaluateXPathString = function(domNode, xPath) {
        var document = domNode.ownerDocument;
        var xpathResult = this.evaluateXPath(document, domNode, xPath, Constants.XPATH_STRING_TYPE);
        return xpathResult.stringValue;
    };
    
    
    
    //Constants
    this.XML_NODE = {
             XML_NODE_ELEMENT : 1,
             XML_NODE_ATTRIBUTE : 2,
             XML_NODE_TEXT : 3  
    };
   
   
    /**
     * Utility for retrieving a W3C DOM Node &#x27;localName&#x27; attribute across browsers.
     * The localName is the node name without any namespace prefixes
     * @method getNodeLocalName
     * @param domNode - domNode
     * @return String - local name of the node or empty string upon error
     */
    this.getNodeLocalName = function(domNode) {
        if (domNode)
            return domNode.localName ? domNode.localName : domNode.baseName;
        return &quot;&quot;;
    };

    /**
     * Returns the set of classes this node belongs to as an array of strings
     * @method getClassList
     * @param domNode - domNode
     * @return dom - the dom result
     */
    this.getClassList = function(domNode) {
        if (domNode.classList) {
            return domNode.classList;
        } else if (domNode[&#x27;class&#x27;]) {
            return domNode[&#x27;class&#x27;].split(&#x27; &#x27;);
        } else if (domNode.className) {
            return domNode.className.split(&#x27; &#x27;);
        }
        return [];
    };

    /**
     * Figure out if domNode is a leaf or not
     * (Leaves have no nodes from XML_NODE_ELEMENT)
     * @method isLeafNode
     * @param domNode - domNode
     * @return boolean - is leaf or not
     */
    this.isLeafNode = function(domNode) {
        var isLeaf = true;
        if (domNode &amp;&amp; domNode.childNodes) {
            for ( var i = 0; i &lt; domNode.childNodes.length &amp;&amp; isLeaf; i++) {
                isLeaf = domNode.childNodes[i].nodeType !== this.XML_NODE.XML_NODE_ELEMENT;
            }
        }
        return isLeaf;
    };

    /**
     * Filters an array of DOM Nodes according to the specified parameters
     * @method filterNodeArray
     * @param nodeArray An Array of DOM Nodes
     * @param nodeType [Optional] An integer node type
     * @param namespaceUri [Optional] String to compare against node namespaceURI
     * @param nodeName [Optional] String to compare against the node localName
     * @return dom - return the result in a dom
     */
   this.filterNodeArray = function(nodeArray, nodeType, namespaceUri, nodeName) {
        var matchingNodes = [];
        for (var i = 0; i &lt; nodeArray.length; i++) {
            var node = nodeArray[i];

            if (nodeType &amp;&amp; node.nodeType !== nodeType) {
                continue;
            }

            if (namespaceUri &amp;&amp; namespaceUri !== node.namespaceURI) {
                continue;
            }

            if (nodeName &amp;&amp; nodeName !== this.getNodeLocalName(node)) {
                continue;
            }

            matchingNodes.push(node);
        }

        return matchingNodes;
    };

    /**
     * Gets all children of domNode as an Array that match the specified filter parameters
     * @method getMatchingChildNodes
     * @param childNamespaceURI [Optional] The URI to lookup as a String
     * @param childNodeName [Optional] The node name to lookup as a String
     * @return dom - return the result in a dom
     */
    this.getMatchingChildNodes = function(domNode, childNamespaceURI, childNodeName) {
        return this.filterNodeArray(domNode.childNodes, this.XML_NODE.XML_NODE_ELEMENT, childNamespaceURI, childNodeName);
    };

    /**
     * Gets all Attributes of domNode as an Array that match the specified filter parameters
     * @method getMatchingAttributes
     * @param childNamespaceURI [Optional] The URI to lookup as a String
     * @param childNodeName [Optional] The node name to lookup as a String
     * @return dom - return the result in a dom or null upon error
     */
    this.getMatchingAttributes = function(domNode, attributeNamespaceURI, attributeName) {
        //VT: cannot find the _fitlerNodeArray, suspect bug
        //return this._filterNodeArray(domNode.attributes, XML_NODE_ATTRIBUTE, attributeNamespaceURI, attributeName);
        if (domNode.attributes) {
            return this.filterNodeArray(domNode.attributes, this.XML_NODE.XML_NODE_ATTRIBUTE, attributeNamespaceURI, attributeName);
        }
        return null;
    };

    /**
     * Given a DOM node, return its text content (however the browser defines it)
     * @method getNodeTextContent
     * @param domNode - domNode
     * @return string - text content
     */
    this.getNodeTextContent = function(domNode) {
        if (domNode) 
            return domNode.textContent ? domNode.textContent : domNode.text;
        return &quot;&quot;;
    };

    /**
     * Parse string to DOM
     * @method parseStringToDOM
     * @param xmlString - xml string
     * @return dom - return the result in a dom
     */
    this.parseStringToDOM = function(xmlString){
        var isIE11 = !!navigator.userAgent.match(/Trident.*rv[ :]*11\./);
        // Load our xml string into DOM
        var xmlDocument = null;
        if(window.DOMParser) {
            //browser supports DOMParser
            var parser = new DOMParser();
            xmlDocument = parser.parseFromString(xmlString, &quot;text/xml&quot;);
        } else if(window.ActiveXObject) {
            //IE
            xmlDocument = new ActiveXObject(&quot;Microsoft.XMLDOM&quot;);
            xmlDocument.async=&quot;false&quot;;
            xmlDocument.loadXML(xmlString);
        } else {
            return null;
        }
        return xmlDocument;
    };
    
     
}]);
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
